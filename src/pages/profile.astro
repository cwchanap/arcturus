---
import CasinoLayout from '../layouts/casino.astro';

const session = Astro.locals.session;

if (!session) {
	return Astro.redirect('/signin');
}

const { user } = session;
const fallbackInitial = user?.name?.[0]?.toUpperCase() ?? user?.email?.[0]?.toUpperCase() ?? 'A';
---

<CasinoLayout title="Player Profile - Arcturus Casino">
	<section class="relative overflow-hidden">
		<div class="absolute inset-0 pointer-events-none">
			<div class="absolute top-24 -left-20 h-72 w-72 bg-yellow-500/10 rounded-full blur-3xl"></div>
			<div class="absolute bottom-10 right-0 h-64 w-64 bg-amber-500/10 rounded-full blur-3xl"></div>
		</div>

		<div class="relative max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
			<div class="bg-slate-900/80 border border-yellow-500/20 rounded-3xl shadow-2xl">
				<div class="flex flex-col gap-10 p-8 sm:p-12">
					<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-8">
						<div class="flex items-center gap-5">
							<div
								class="flex h-20 w-20 items-center justify-center rounded-2xl bg-gradient-to-br from-yellow-400 via-amber-500 to-yellow-600 text-3xl font-bold text-slate-900"
							>
								{
									user.image ? (
										<img
											src={user.image}
											alt={user.name ?? user.email ?? 'Player Avatar'}
											class="h-20 w-20 rounded-2xl object-cover"
										/>
									) : (
										<span>{fallbackInitial}</span>
									)
								}
							</div>
							<div>
								<p class="text-sm uppercase tracking-widest text-yellow-400/80">Player Profile</p>
								<h1 class="mt-2 text-3xl font-semibold text-white">
									{user.name ?? 'Casino Adventurer'}
								</h1>
								<p class="text-slate-400">{user.email}</p>
							</div>
						</div>
						<div class="flex items-center gap-4 self-start md:self-auto">
							<span
								class={`inline-flex items-center gap-2 rounded-full border px-4 py-1 text-xs font-semibold uppercase tracking-widest ${
									user.emailVerified
										? 'border-emerald-400/40 text-emerald-300'
										: 'border-yellow-500/40 text-yellow-300'
								}`}
							>
								{user.emailVerified ? 'Email Verified' : 'Verification Pending'}
							</span>
							<button
								id="signout-btn"
								type="button"
								class="group relative inline-flex items-center gap-2 overflow-hidden rounded-full border border-yellow-500/40 bg-slate-900/60 px-6 py-3 text-sm font-semibold text-yellow-300 transition focus:outline-none focus:ring-2 focus:ring-yellow-500/60 focus:ring-offset-2 focus:ring-offset-slate-900"
							>
								<span
									class="absolute inset-0 -z-10 translate-y-full bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-600 opacity-90 transition-transform duration-300 group-hover:translate-y-0"
								></span>
								<span class="group-hover:text-slate-900">Sign out</span>
							</button>
						</div>
					</div>

					<div class="grid grid-cols-1 gap-6 md:grid-cols-2">
						<div class="rounded-2xl border border-white/5 bg-slate-950/40 p-6">
							<h2 class="text-lg font-semibold text-white">Account Details</h2>
							<dl class="mt-6 space-y-4 text-sm text-slate-300">
								<div class="flex items-start justify-between">
									<dt class="text-slate-400">Player Name</dt>
									<dd class="font-medium text-white">{user.name ?? 'Not set'}</dd>
								</div>
								<div class="flex items-start justify-between">
									<dt class="text-slate-400">Email Address</dt>
									<dd class="font-medium text-white">{user.email}</dd>
								</div>
								<div class="flex items-start justify-between">
									<dt class="text-slate-400">Email Status</dt>
									<dd class="font-medium text-white">
										{user.emailVerified ? 'Verified' : 'Awaiting verification'}
									</dd>
								</div>
							</dl>
						</div>
						<div class="rounded-2xl border border-white/5 bg-slate-950/40 p-6">
							<h2 class="text-lg font-semibold text-white">Casino Tips</h2>
							<ul class="mt-6 space-y-4 text-sm text-slate-300">
								<li class="flex items-start gap-3">
									<span class="text-xl">üéÅ</span>
									<span>Claim your daily chip bonus to keep the games going.</span>
								</li>
								<li class="flex items-start gap-3">
									<span class="text-xl">üèÜ</span>
									<span>Visit the tournaments page to join upcoming events.</span>
								</li>
								<li class="flex items-start gap-3">
									<span class="text-xl">ü§ù</span>
									<span>Invite friends for exclusive in-game rewards.</span>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</CasinoLayout>

<script>
	import { authClient } from '../lib/auth-client';

	const signoutBtn = document.getElementById('signout-btn');

	signoutBtn?.addEventListener('click', async () => {
		try {
			await authClient.signOut();
			window.location.href = '/signin';
		} catch (error) {
			console.error('Sign out error:', error);
		}
	});
</script>
